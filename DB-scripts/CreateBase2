

DROP TYPE IF EXISTS vdv_prop_type CASCADE;
CREATE TYPE vdv_prop_type AS ENUM ('bool', 'int', 'real', 'media', 'comment', 'like', 'location', 'post', 'request', 'equipment', 'sport', 'courtTime', 'requestTime');

DROP TABLE IF EXISTS "vdv_prop";
CREATE TABLE "vdv_prop" (
	"vdvid" BIGSERIAL NOT NULL PRIMARY KEY,
	"name" VARCHAR(40) NOT NULL UNIQUE,
	"type" vdv_prop_type NOT NULL
) WITH (
  OIDS=FALSE
);

INSERT INTO vdv_prop (vdvid, name, type) VALUES (NEXTVAL('vdv_seq'), 'location', 'location');
INSERT INTO vdv_prop (vdvid, name, type) VALUES (NEXTVAL('vdv_seq'), 'equipment', 'equipment');
INSERT INTO vdv_prop (vdvid, name, type) VALUES (NEXTVAL('vdv_seq'), 'sport', 'sport');
INSERT INTO vdv_prop (vdvid, name, type) VALUES (NEXTVAL('vdv_seq'), 'courtTime', 'courtTime');
INSERT INTO vdv_prop (vdvid, name, type) VALUES (NEXTVAL('vdv_seq'), 'requestTime', 'requestTime');
INSERT INTO vdv_prop (vdvid, name, type) VALUES (NEXTVAL('vdv_seq'), 'media', 'media');

DROP SEQUENCE IF EXISTS vdv_seq;
CREATE SEQUENCE vdv_seq start with 1 increment by 1;

DROP SEQUENCE IF EXISTS vdv_req;
CREATE SEQUENCE vdv_req start with 1 increment by 1;

DROP SEQUENCE IF EXISTS vdv_prop_seq;
CREATE SEQUENCE vdv_prop_seq start with 1 increment by 1;

DROP TYPE IF EXISTS vdv_media_type CASCADE;
CREATE TYPE vdv_media_type AS ENUM ('image', 'equipment');

DROP TABLE IF EXISTS "vdv_media" CASCADE;

CREATE TABLE "vdv_media" (
	"vdvid" BIGSERIAL NOT NULL,
	"ownerid" int8,
	"name" varchar(256) NOT NULL DEFAULT ''::character varying,
	"desc" varchar(4000) NOT NULL DEFAULT ''::character varying,
	"type" vdv_media_type NOT NULL,
	"url" varchar(4000) NOT NULL,
	"created" timestamp with time zone NOT NULL,
	CONSTRAINT "vdv_media_pkey" PRIMARY KEY("vdvid"),
	CONSTRAINT "vdv_media_url_key" UNIQUE("url")
)
WITH (
	OIDS = False
);

ALTER TABLE "vdv_media" OWNER TO "postgres";

DROP TABLE IF EXISTS "vdv_tariff" CASCADE;

CREATE TABLE "vdv_tariff" (
	"vdvid" int8 NOT NULL,
	"months" int4 NOT NULL,
	"price" int4 NOT NULL,
	"sale" int4 NOT NULL,
	PRIMARY KEY("vdvid")
);

DROP TABLE IF EXISTS "vdv_prop_media" CASCADE;

CREATE TABLE "vdv_prop_media" (
	"vdvid" int8 NOT NULL,
	"propid" int8 NOT NULL,
	"value" int8 NOT NULL,
	"id" int8 NOT NULL,
	CONSTRAINT "vdv_prop_media_pkey" PRIMARY KEY("id"),
	CONSTRAINT "Ref_vdv_prop_media_to_vdv_court" FOREIGN KEY ("vdvid")
		REFERENCES "vdv_court"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE,
	CONSTRAINT "Ref_vdv_prop_media_to_vdv_media" FOREIGN KEY ("value")
		REFERENCES "vdv_media"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
)
WITH (
	OIDS = False
);

ALTER TABLE "vdv_prop_media" OWNER TO "postgres";

DROP TABLE IF EXISTS "vdv_account" CASCADE;

CREATE TABLE "vdv_account" (
	"vdvid" BIGSERIAL NOT NULL,
	"name" varchar(256),
	"phone" varchar(30) NOT NULL,
	"created" timestamp with time zone,
	"updated" timestamp with time zone,
	"mediaid" int8,
	"email" varchar(256),
	"password" varchar(256),
	"accounttype" varchar(30),
	PRIMARY KEY("vdvid"),
	CONSTRAINT "Ref_vdv_account_to_vdv_media" FOREIGN KEY ("mediaid")
		REFERENCES "vdv_media"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
);

DROP TABLE IF EXISTS "vdv_validation" CASCADE;

CREATE TABLE "vdv_validation" (
	"vdvid" BIGSERIAL NOT NULL,
	"accountid" int8,
	"code" int8,
	"timesend" timestamp with time zone,
	"timesaday" int4,
	PRIMARY KEY("vdvid"),
	CONSTRAINT "Ref_vdv_validation_to_vdv_account" FOREIGN KEY ("accountid")
		REFERENCES "vdv_account"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
);


DROP TABLE IF EXISTS "vdv_landlord" CASCADE;

CREATE TABLE "vdv_landlord" (
	"vdvid" BIGSERIAL NOT NULL,
	"accountid" int8,
	"money" int4,
	"isentity" bool,
	"company" varchar(256),
	"isagreerules" bool NOT NULL,
	PRIMARY KEY("vdvid"),
	CONSTRAINT "Ref_vdv_landlord_to_vdv_account" FOREIGN KEY ("accountid")
		REFERENCES "vdv_account"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
)
WITH (
	OIDS = False
);

DROP TABLE IF EXISTS "vdv_simple_user" CASCADE;

CREATE TABLE "vdv_simple_user" (
	"vdvid" BIGSERIAL NOT NULL,
	"accountid" int8,
	"isagreerules" bool NOT NULL,
	CONSTRAINT "vdv_user_pkey" PRIMARY KEY("vdvid"),
	CONSTRAINT "Ref_vdv_simple_user_to_vdv_account" FOREIGN KEY ("accountid")
		REFERENCES "vdv_account"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
)
WITH (
	OIDS = False
);

ALTER TABLE "vdv_simple_user" OWNER TO "postgres";

DROP TABLE IF EXISTS "vdv_admin" CASCADE;

CREATE TABLE "vdv_admin" (
	"vdvid" BIGSERIAL NOT NULL,
	"accountid" int8,
	PRIMARY KEY("vdvid"),
	CONSTRAINT "Ref_vdv_admin_to_vdv_account" FOREIGN KEY ("accountid")
		REFERENCES "vdv_account"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
)
WITH (
	OIDS = False
);

ALTER TABLE "vdv_admin" OWNER TO "postgres";

DROP TABLE IF EXISTS "vdv_court" CASCADE;

CREATE TABLE "vdv_court" (
	"vdvid" BIGSERIAL NOT NULL,
	"ownerid" BIGSERIAL NOT NULL,
	"name" varchar(256) NOT NULL,
	"desc" varchar(4000) NOT NULL DEFAULT ''::character varying,
	"price" int4,
	"timebegin" timestamp with time zone,
	"timeend" timestamp with time zone,
	"ispublished" bool,
	"created" timestamp with time zone NOT NULL,
	"updated" timestamp with time zone NOT NULL,
	"isdraft" bool NOT NULL,
	"mainmediaid" int8,
	CONSTRAINT "vdv_court_pkey" PRIMARY KEY("vdvid"),
	CONSTRAINT "Ref_vdv_court_to_vdv_landlord" FOREIGN KEY ("ownerid")
		REFERENCES "vdv_landlord"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
)
WITH (
	OIDS = False
);

ALTER TABLE "vdv_court" OWNER TO "postgres";

DROP TABLE IF EXISTS "vdv_location" CASCADE;

CREATE TABLE "vdv_location" (
	"vdvid" BIGSERIAL NOT NULL,
	"name" varchar(256) NOT NULL,
	"latitude" float4 NOT NULL,
	"longitude" float4 NOT NULL,
	CONSTRAINT "vdv_location_pkey" PRIMARY KEY("vdvid")
)
WITH (
	OIDS = False
);

ALTER TABLE "vdv_location" OWNER TO "postgres";

DROP TABLE IF EXISTS "vdv_prop_location" CASCADE;

CREATE TABLE "vdv_prop_location" (
	"vdvid" int8 NOT NULL,
	"propid" int8 NOT NULL,
	"value" int8 NOT NULL,
	"id" int8 NOT NULL,
	PRIMARY KEY("id"),
	CONSTRAINT "Ref_vdv_prop_location_to_vdv_court" FOREIGN KEY ("vdvid")
		REFERENCES "vdv_court"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE,
	CONSTRAINT "Ref_vdv_prop_location_to_vdv_location" FOREIGN KEY ("value")
		REFERENCES "vdv_location"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
)
WITH (
	OIDS = False
);

ALTER TABLE "vdv_prop_location" OWNER TO "postgres";

DROP TABLE IF EXISTS "vdv_sport" CASCADE;

CREATE TABLE "vdv_sport" (
	"vdvid" int8 NOT NULL,
	"name" varchar(40),
	PRIMARY KEY("vdvid")
);


DROP TABLE IF EXISTS "vdv_prop_sport" CASCADE;

CREATE TABLE "vdv_prop_sport" (
	"value" int8,
	"vdvid" int8,
	"propid" int8 NOT NULL,
	"id" int8 NOT NULL,
	PRIMARY KEY("id"),
	CONSTRAINT "Ref_vdv_prop_sport_to_vdv_sport" FOREIGN KEY ("value")
		REFERENCES "vdv_sport"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE,
	CONSTRAINT "Ref_vdv_prop_sport_to_vdv_court" FOREIGN KEY ("vdvid")
		REFERENCES "vdv_court"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
);

DROP TABLE IF EXISTS "vdv_equipment" CASCADE;

CREATE TABLE "vdv_equipment" (
	"vdvid" int8 NOT NULL,
	"name" varchar(40),
	PRIMARY KEY("vdvid")
);

DROP TABLE IF EXISTS "vdv_prop_equipment" CASCADE;

CREATE TABLE "vdv_prop_equipment" (
	"value" int8,
	"propid" int8 NOT NULL,
	"vdvid" int8 NOT NULL,
	"id" int8 NOT NULL,
	PRIMARY KEY("id"),
	CONSTRAINT "Ref_vdv_prop_equipment_to_vdv_court" FOREIGN KEY ("vdvid")
		REFERENCES "vdv_court"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE,
	CONSTRAINT "Ref_vdv_prop_equipment_to_vdv_equipment" FOREIGN KEY ("value")
		REFERENCES "vdv_equipment"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
);

DROP TABLE IF EXISTS "vdv_time" CASCADE;

CREATE TABLE "vdv_time" (
	"vdvid" int8 NOT NULL,
	"time" timestamp with time zone,
	PRIMARY KEY("vdvid")
);

DROP TABLE IF EXISTS "vdv_prop_court_time" CASCADE;

CREATE TABLE "vdv_prop_court_time" (
	"propid" int8 NOT NULL,
	"value" int8,
	"vdvid" int8,
	"id" int8 NOT NULL,
	PRIMARY KEY("id"),
	CONSTRAINT "Ref_vdv_prop_court_time_to_vdv_court" FOREIGN KEY ("vdvid")
		REFERENCES "vdv_court"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE,
	CONSTRAINT "Ref_vdv_prop_court_time_to_vdv_time" FOREIGN KEY ("value")
		REFERENCES "vdv_time"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
);

DROP TABLE IF EXISTS "vdv_request" CASCADE;

CREATE TABLE "vdv_request" (
	"vdvid" int8 NOT NULL,
	"accountid" int8 NOT NULL,
	"courtid" int8,
	"isconfirmed" bool,
	"ownertype" varchar(40),
	"requestid" int8,
	"come" bool,
	"iscanceled" bool NOT NULL,
	PRIMARY KEY("vdvid"),
	CONSTRAINT "Ref_vdv_request_to_vdv_account" FOREIGN KEY ("accountid")
		REFERENCES "vdv_account"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE,
	CONSTRAINT "Ref_vdv_request_to_vdv_court" FOREIGN KEY ("courtid")
		REFERENCES "vdv_court"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
);
DROP TABLE IF EXISTS "vdv_prop_request_time" CASCADE;

CREATE TABLE "vdv_prop_request_time" (
	"propid" int8,
	"value" int8,
	"vdvid" int8,
	"id" int8 NOT NULL,
	PRIMARY KEY("id"),
	CONSTRAINT "Ref_vdv_prop_request_time_to_vdv_request" FOREIGN KEY ("vdvid")
		REFERENCES "vdv_request"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE,
	CONSTRAINT "Ref_vdv_prop_request_time_to_vdv_time" FOREIGN KEY ("value")
		REFERENCES "vdv_time"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
);

DROP TABLE IF EXISTS "vdv_help" CASCADE;

CREATE TABLE "vdv_help" (
	"vdvid" int8 NOT NULL,
	"accountid" int8,
	"message" varchar(3000) NOT NULL,
	"created" timestamp with time zone NOT NULL,
	"isdone" bool NOT NULL,
	"donetime" timestamp with time zone,
	PRIMARY KEY("vdvid"),
	CONSTRAINT "Ref_vdv_help_to_vdv_account" FOREIGN KEY ("accountid")
		REFERENCES "vdv_account"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
);

DROP TABLE IF EXISTS "vdv_extention" CASCADE;

CREATE TABLE "vdv_extention" (
	"vdvid" int8 NOT NULL,
	"courtid" int8 NOT NULL,
	"tariffid" int8,
	"isconfirmed" bool NOT NULL,
	"confirmedtime" timestamp with time zone,
	"created" timestamp with time zone,
	"adminid" int8,
	PRIMARY KEY("vdvid"),
	CONSTRAINT "Ref_vdv_extension_to_vdv_court" FOREIGN KEY ("courtid")
		REFERENCES "vdv_court"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE,
	CONSTRAINT "Ref_vdv_extension_to_vdv_tariff" FOREIGN KEY ("tariffid")
		REFERENCES "vdv_tariff"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE,
	CONSTRAINT "Ref_vdv_extension_to_vdv_admin" FOREIGN KEY ("adminid")
		REFERENCES "vdv_admin"("vdvid")
	MATCH SIMPLE
	ON DELETE NO ACTION
	ON UPDATE NO ACTION
	NOT DEFERRABLE
);

INSERT INTO vdv_account (vdvid, name, phone, accounttype) VALUES (1000, 'tester', '79110001122', 'landlord');
INSERT INTO vdv_validation (vdvid, accountid, code) VALUES (NEXTVAL('vdv_seq'), 1000, 10000);

INSERT INTO vdv_sport (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Футбол');
INSERT INTO vdv_sport (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Футбол S');
INSERT INTO vdv_sport (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Футбол M');
INSERT INTO vdv_sport (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Футбол L');
INSERT INTO vdv_sport (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Волейбол');
INSERT INTO vdv_sport (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Баскетбол');
INSERT INTO vdv_sport (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Танцы');
INSERT INTO vdv_sport (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Йога');

INSERT INTO vdv_equipment (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Мяч');
INSERT INTO vdv_equipment (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Пуфик');
INSERT INTO vdv_equipment (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Диван');
INSERT INTO vdv_equipment (vdvid, name) VALUES (NEXTVAL('vdv_seq'), 'Телевизор');

INSERT INTO vdv_tariff (vdvid, months, price, sale) VALUES (NEXTVAL('vdv_seq'), '3', '1000', '0');
INSERT INTO vdv_tariff (vdvid, months, price, sale) VALUES (NEXTVAL('vdv_seq'), '6', '2000', '10');
INSERT INTO vdv_tariff (vdvid, months, price, sale) VALUES (NEXTVAL('vdv_seq'), '12', '4000', '20');

INSERT INTO vdv_admin (vdvid, accountid) VALUES (NEXTVAL('vdv_seq'), '1000');